#!/bin/bash
set -e

echo "ğŸš€ Starting VisaPro Server in Development Mode..."

# Load environment variables
if [ -f .env ]; then
  export $(cat .env | grep -v '^#' | xargs)
fi

# Check if PostgreSQL is running
if ! pg_isready -h localhost -p 5432 >/dev/null 2>&1; then
  echo "âŒ PostgreSQL is not running. Please start it with: sudo service postgresql start"
  exit 1
fi

# Install dependencies if needed
echo "ğŸ“¦ Checking dependencies..."
bundle check || bundle install

# Setup database
echo "ğŸ—„ï¸  Setting up database..."
rails db:create db:migrate

echo "âœ… Starting Rails server..."
rails server -b 0.0.0.0 -p 3000